# spell-checker: ignore strftime tfvars inspec
<%
# Fall back to current time and known location for report files if not present
# in ENV
report_dir = ENV['REPORT_DIR'] || DateTime.now.strftime('test/reports/%Y%m%d')
report_ts = ENV['REPORT_TS'] || DateTime.now.rfc3339
%>
---
driver:
  name: terraform
  command_timeout: 300
  verify_version: true
  variables:
    # These variables are applied to every platform (gcp/aws/azure) and suite
    gcpRegion: us-west1
  # This file will be generated by test/setup Terraform
  # NOTE: values in this file will override the 'variables:' section everywhere
  variable_files:
    - test/setup/harness.tfvars

provisioner:
  name: terraform

verifier:
  name: terraform
  color: true

platforms:
  - name: google-workstation-default
    driver:
      root_module_directory: test/fixtures/google/workstation
      variables:
        variant: def
    verifier:
      systems:
        - name: inspec-gcp
          backend: gcp
          reporter:
            - cli
            - documentation:<%= report_dir %>/google-workstation-default-<%= report_ts %>.txt
            - html2:<%= report_dir %>/google-workstation-default-<%= report_ts %>.html
  - name: google-workstation-example
    driver:
      root_module_directory: test/fixtures/google/workstation/example
    verifier:
      systems:
        - name: inspec-gcp
          backend: gcp
          reporter:
            - cli
            - documentation:<%= report_dir %>/google-workstation-example-<%= report_ts %>.txt
            - html2:<%= report_dir %>/google-workstation-example-<%= report_ts %>.html

suites:
  - name: gcp-workstation
    includes:
      - google-workstation-default
      - google-workstation-example
